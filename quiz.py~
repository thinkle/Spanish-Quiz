from django.http import HttpResponse, HttpResponseRedirect
from django import forms
from django.shortcuts import render_to_response
from django.template import Context, loader
import sys
import re, random
from django.utils import simplejson

# Data model
# sample_data_set = [['hablo','I talk'],
#                    ['hablas','You talk'],
#                    ['habla','He talks'],
#                    ['hablamos','We talk'],
#                    ['hablan','They talk'],
#                    ['como','I eat'],
#                    ['come','He eats'],
#                    ['comes','You eat'],
#                    ['comen','They eat'],
#                    ['comemos','We eat'],                                      
#                    ]
sample_data_set = []
ifi = file('unordered_first_161_words.txt','r')
for l in ifi.readlines():
    words = l.split(':')
    words = [w.strip() for w in words]
    sample_data_set.append(words)

print sample_data_set

CORRECT = 0
TRIED = 0


def index (request):
    return render_to_response(
        'index.html',
        {})

def mc (request):
    my_data = sample_data_set[:]
    random.shuffle(my_data)
    q_a = my_data.pop()
    answers = [q_a[1]] + [d[1] for d in  random.sample(my_data,3)]
    random.shuffle(answers)
    answer_rows = [[answers[0],answers[1]],[answers[2],answers[3]]]
    return render_to_response(
        'simple_quiz.html',
        {'record':(TRIED and '%s/%s'%(CORRECT,TRIED) or ''),
         'question':q_a[0],
         'answer':q_a[1],
        'answer_rows':answer_rows,
         })
         
def mc_answer (request):
    global CORRECT,TRIED
    if request.method == 'POST':
        answer = request.POST['answer']
        correct_answer = request.POST['correct_answer']
        if answer==correct_answer:
            CORRECT += 1
        TRIED += 1
        return HttpResponseRedirect('/mc/')
                

